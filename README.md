# Incident Response Report Lab with LimaCharlie (Wevtutil.exe Abuse)

## Project Overview

**Project Name:** Incident Response Report Lab with LimaCharlie (Wevtutil.exe Abuse)  
**Goal:** To simulate a real-world incident response scenario involving suspicious use of `wevtutil.exe` and generate a detailed incident response report based on the findings.

## Steps and Components

### 1. Setup Overview
- **Windows VM:** Client machine that will simulate suspicious activity involving `wevtutil.exe`.
- **Ubuntu VM:** SOC monitor with LimaCharlie deployed for incident detection and response.
- **LimaCharlie:** Used for endpoint detection and response (EDR) to monitor and respond to the incident

![instances](https://github.com/user-attachments/assets/5a35a1de-7d81-448b-adac-1f6efa796679)

* Install LimaCharlie agent on Windows instance.
  ![limacharlie windows installation 2](https://github.com/user-attachments/assets/4b691068-a45e-42ba-bdb8-730869d9a74d)
  ![limacharlie windows installation 3](https://github.com/user-attachments/assets/757d638f-6623-4fa5-a11a-a5ec667599b9)
  ![limacharlie windows installation complete](https://github.com/user-attachments/assets/545343bf-0254-4ee0-8479-a097d7169e2a)

* Install LimaCharlie agent on Ubuntu instance.
![limacharlie ubuntu installation 1 ](https://github.com/user-attachments/assets/df02ed84-2f2f-4dc2-b8d1-671a5f327371)
![limacharlie ubuntu installation ](https://github.com/user-attachments/assets/9e4253ce-85bd-4938-9dd5-6d77aa2eb676)
![limacharlie ubuntu installation complete ](https://github.com/user-attachments/assets/73953033-ff19-4f63-accf-2331120574fd)

### 2. Incident Simulation
- **Attack Vector:** The simulation will involve suspicious use of `wevtutil.exe`, a legitimate Windows tool often misused by attackers to clear event logs or access event data for malicious purposes.
  - On the Windows VM, run the following command to simulate suspicious activity:
    ```bash
    wevtutil cl System
    ```
    This command clears the System event log, which is highly suspicious and often indicates an attempt to cover tracks.
  
- **Task:** Use LimaCharlie to detect this activity and isolate the Windows machine once the misuse of `wevtutil.exe` is identified.

  ![wevtutil executed over and over again](https://github.com/user-attachments/assets/29185738-4cde-46e0-ad55-5dd94a022458)

### 3. Data Collection and Analysis
- **Using LimaCharlie:**
  - Monitor for unusual command execution, such as the use of `wevtutil.exe` to clear event logs.
  - Collect relevant event logs and process information before the logs are cleared.
  - Use the EDRâ€™s detection capabilities to identify malicious behavior and trigger an alert.

- **Artifacts to Collect:**
  - Event logs: Before they are cleared, collect logs to identify potential signs of compromise.
  - Process execution: Collect details of the `wevtutil.exe` process and command-line arguments.
  - Network activity: Examine any external connections that might indicate exfiltration attempts.
  - LimaCharlie logs and alerts generated by this activity.

### 4. Incident Response Steps
- **Detection:** Detect the abnormal use of `wevtutil.exe` using LimaCharlie.
- **Isolation:** Isolate the Windows VM after detecting the malicious activity.
- **Data Collection:** Retrieve event logs and details from LimaCharlie before the logs are cleared.
- **Analysis:** Analyze the artifacts to determine if the `wevtutil.exe` misuse was part of a larger attack chain (e.g., clearing logs to cover up malicious activity).
- **Mitigation:** Apply containment measures, such as isolating the machine and removing any malicious processes.

### 5. Creating the Incident Response Report
- **Executive Summary:** Provide a high-level summary of the incident involving the suspicious use of `wevtutil.exe`, its potential impact, and the steps taken to mitigate it.
- **Detection and Investigation:** Detail the LimaCharlie logs and alerts that flagged the misuse of `wevtutil.exe` and include any other abnormal findings from event logs, processes, or network traffic.
- **Root Cause Analysis:** Analyze why and how the event log clearing occurred and whether it was part of a larger attack strategy.
- **Mitigation Steps:** Document the actions taken, such as isolating the affected system and identifying the malicious process.
- **Lessons Learned:** Suggest improvements in monitoring, detection, or policy to prevent future incidents involving misuse of legitimate tools like `wevtutil.exe`.
- **Artifacts Collected:** Include a list of event logs, process information, network activity, and LimaCharlie alerts that were collected during the investigation.












# Incident Response Report

**Incident ID:** IR-2024-001  
**Incident Date:** 2024-10-13  
**Report Date:** 2024-10-13  
**Analyst Name:** Xarius  
**SOC Team:** Lab Incident Response Team  

## Executive Summary
On 2024-10-13, multiple suspicious events were detected on the instance `ec2amaz-h6d1h61.us-east-2.compute.internal`, indicating potential malicious activity involving event log clearing and configuration changes. The use of `wevtutil.exe`, a legitimate Windows tool, to clear security logs raises significant concerns, particularly in an environment where monitoring and logging are crucial for detecting unauthorized activities. 

## Incident Details

### Timeline of Events
| Timestamp              | Event Type                                 | Description                                                                                                                                                   |
|------------------------|--------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 2024-10-13 04:29:36    | Suspicious Eventlog Clearing Activity      | Command executed: `wevtutil cl System` to clear the System event log.                                                                                      |
| 2024-10-13 04:30:37    | Suspicious Eventlog Clearing Activity      | Command executed: `wevtutil cl System` (duplicate of previous).                                                                                             |
| 2024-10-13 04:31:09    | Suspicious Eventlog Clearing Activity      | Command executed: `wevtutil cl security` to clear the Security event log.                                                                                   |
| 2024-10-13 05:32:12    | Suspicious Eventlog Clearing Activity      | Command executed: `wevtutil cl security /c:10` to clear the last 10 events in the Security event log.                                                       |
| 2024-10-13 05:32:27    | Suspicious Eventlog Clearing Activity      | Command executed: `wevtutil cl security` to clear the Security event log again.                                                                             |
| 2024-10-11 03:26:49    | Use Short Name Path in Command Line       | Command executed: `wevtutil im "C:\Users\ADMINI~1\AppData\Local\Temp\2\MAN8.tmp"` using the short name path for a potentially malicious file.                |

### Event Analysis
- **Tools Involved:** The tool `wevtutil.exe`, located in `C:\Windows\system32\`, is a legitimate Windows executable used for managing event logs. However, its usage in clearing logs is concerning as it may indicate an attempt to cover tracks following malicious activity.
- **User Context:** The commands were executed under the `EC2AMAZ-H6D1H61\Administrator` user account, which typically has elevated privileges, raising suspicion regarding the intent behind the log clearing.
- **Processes Involved:** The commands were initiated by `powershell.exe` and `cmd.exe`, which are common command-line interfaces on Windows systems, further obscuring the malicious activity. 

### Event Correlation
The pattern of clearing both System and Security logs within a short timeframe suggests a deliberate effort to erase potential traces of unauthorized actions. The duplicate event clearing commands also indicate an ongoing attempt to ensure log records do not capture relevant information.

### Potential Impact
If this activity is determined to be malicious, it could indicate a compromise of the `Administrator` account or a potentially exploited vulnerability. The clearing of logs significantly hampers incident detection and response efforts, allowing further malicious activities to go undetected.

## Recommendations
1. **Immediate Actions:**
   - Isolate the affected instance to prevent further malicious actions.
   - Preserve all logs and event data prior to isolation to maintain evidence for further analysis.

2. **Further Investigation:**
   - Conduct a full forensic analysis of the affected instance, focusing on:
     - User activity leading up to the event log clearing.
     - Network traffic analysis to identify any unauthorized external communications.
     - Review of additional system logs for other potential indicators of compromise (IoCs).

3. **Mitigation Measures:**
   - Strengthen access controls for sensitive accounts, particularly those with administrative privileges.
   - Implement monitoring and alerting mechanisms for suspicious use of `wevtutil.exe` and other administrative tools.
   - Educate staff on the importance of log integrity and the implications of log clearing on incident response capabilities.

4. **Post-Incident Review:**
   - Analyze the incident's root cause and develop a report summarizing findings, actions taken, and lessons learned.
   - Update incident response plans and security policies based on insights from this incident.

## Conclusion
The analysis of the suspicious events related to event log clearing indicates a significant risk to the security posture of the environment. Immediate containment and thorough investigation are essential to determine the extent of any potential compromise and to restore confidence in the integrity of the logging and monitoring systems.
